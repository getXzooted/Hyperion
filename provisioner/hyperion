#!/bin/bash
#
# The Hyperion Command Line Interface


# Check for root privileges
if [[ $EUID -ne 0 ]]; then
   echo "This command must be run as root. Please use 'sudo hyperion'."
   exit 1
fi

BASE_PLATFORM_MARKER="/etc/hyperion/state/base_platform_complete.done"

# A) Check if the base platform is fully provisioned.
if [ -f "$BASE_PLATFORM_MARKER" ]; then
    echo "--> Base platform is stable. Running the Git input script..."
    # B) If it is, run the script that handles custom deployments.
    bash /opt/Hyperion/provisioner/input-git.sh
else
    # If the platform is NOT complete, show the service logs.
    echo "--> Base platform provisioning is still in progress."
    echo "--> Tailing live logs from the hyperion.service..."
    echo "    (Press Ctrl+C to stop watching)"
    journalctl -fu hyperion.service
fi